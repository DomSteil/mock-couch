<!DOCTYPE html><html class="no-js"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>mockcouch</title><meta name="description" content="a-nodejs-module-designed-to-mock-a-couchdb-database-mostly-for-unit-testing-purposes"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="shortcut icon" href="favicon.png"><link rel="stylesheet" href="css/styles.css"></head><body><header role="banner" class="navbar navbar-inverse navbar-fixed-top"><div class="container"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target=".navbar-collapse" class="navbar-toggle"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="#home" class="navbar-brand">Mock Couch</a></div><nav role="navigation" class="collapse navbar-collapse"><ul class="nav navbar-nav"><li><a href="https://github.com/chris-l/mock-couch">@Github</a></li></ul></nav></div></header><a name="home"></a><div class="jumbotron"><div class="container"><div class="row"><div class="col-md-7"><h1><img src="img/title.png" alt="The Mock Couch"/><p class="lead">Mock a CouchDB server for unit testing CouchDB based apps.</p><p><a href="https://travis-ci.org/chris-l/mock-couch"><img src="https://travis-ci.org/chris-l/mock-couch.png?branch=master"/></a></p><p><iframe src="http://ghbtns.com/github-btn.html?user=chris-l&amp;repo=mock-couch&amp;type=watch&amp;count=true" allowtransparency="true" frameborder="0" scrolling="0" width="130" height="30"></iframe><iframe src="http://ghbtns.com/github-btn.html?user=chris-l&amp;repo=mock-couch&amp;type=fork&amp;count=true" allowtransparency="true" frameborder="0" scrolling="0" width="130" height="30"></iframe></p></h1></div><div class="col-md-5"><img src="img/mock-couch.svg" alt="A photo of a Mock Couch" title="&quot;It's the thing Mock Couch Soup is made from,&quot; said the Queen."/></div></div></div></div><div class="container"><div class="row"><div id="leftCol" class="col-md-3"><ul id="sidebar" class="nav nav-stacked"><li><a href="#about">About</a></li><li><a href="#installation">Installation</a></li><li><a href="#create">Create an Instance</a></li><li><a href="#methods">Methods</a><ul><li><a href="#listen">listen</a></li><li><a href="#close">close</a></li><li><a href="#addDB">addDB</a></li><li><a href="#addDoc">addDoc</a></li></ul></li><li><a href="#properties">Properties</a><ul><li><a href="#databases">databases</a></li></ul></li><li><a href="#views">Views</a></li><li><a href="#events">Events</a></li><li><a href="#license">License</a></li></ul></div><div class="col-md-9"><p><a name="about"></a></p>
<h2>About Mock Couch</h2>
<p>Mock Couch is an npm module that allows you to create an HTTP server that mocks a CouchDB server by implementing the same RESTful API.</p>
<p>It was desinged mostly for unit testing CouchDB based apps.</p>
<p>Since it will create an actual HTTP server, no matter if you use libraries like cradle or nano, your code should work out of the box.</p>
<p>Mock Couch will emit events, so you can listen to them to see the result of your test.</p>
<p>The project is hosted on <a href="https://github.com/chris-l/mock-couch">GitHub</a>. You can report bugs and discuss features on the <a href="https://github.com/chris-l/mock-couch/issues">issues page</a></p>
<p><a name="installation"></a></p>
<h2>Installation</h2>
<p>Mock Couch is available as an <a href="https://www.npmjs.org/package/mock-couch">npm module</a>.</p>
<pre><code>npm install --save-dev mock-couch</code></pre>
<p><a name="create"></a></p>
<h2>Create a Mock Couch Instance</h2>
<p>To create an instance, it&#39;s necesary to require the module, and then call the <code>createServer()</code> method.</p>
<pre><code class="language-javascript">var mock = require(&#39;mock-couch&#39;);</code></pre>
<p>The returned object is the <strong>mock couch</strong> instance, where the databases and documents should be added.</p>
<p>Once is that is done, its necessary to start the server by calling the <code>listen()</code> method.</p>
<p><a name="createServer"></a></p>
<h3>createServer <code>mock.createServer()</code></h3>
<p>Returns an object representing the <strong>mock couch</strong> instance.</p>
<pre><code class="language-javascript">var mockCouch = mock.createServer();</code></pre>
<p><a name="methods"></a></p>
<h2>Instance Methods</h2>
<p>Each <strong>mock couch</strong> instance has the following methods:</p>
<p><a name="listen"></a></p>
<h3>listen <code>mockCouch.listen([port], arguments*)</code></h3>
<p>Start listening HTTP request at the specified port. If no port was specified, it uses <code>5984</code> by default.</p>
<p>This function calls the <code>listen</code> function from restify with any arguments you pass to it.</p>
<pre><code class="language-javascript">mockCouch.listen(5984, function() {});</code></pre>
<p><a name="close"></a></p>
<h3>close <code>mockCouch.close()</code></h3>
<p>Closes the HTTP server.</p>
<p>This function calls the <code>close</code> function from restify.</p>
<pre><code class="language-javascript">mockCouch.close();</code></pre>
<p><a name="addDB"></a></p>
<h3>addDB <code>mockCouch.addDB(database name, [docs])</code></h3>
<p>Add a new database to the <strong>mock couch</strong> instance, and returns the database object.</p>
<p>The first argument is the name of the database. Optionally you can use a second argument with an array, containg JavaScript objects, being each object a document in the database.</p>
<pre><code class="language-javascript">var peopleDb = mockCouch.addDB(&#39;people&#39;, [
  { _id : &#39;first&#39;, value : 1 },
  { _id : &#39;second&#39;, value : 2 }
]);
peopleDb.first.value === 1; // true</code></pre>
<p><a name="addDoc"></a></p>
<h3>addDoc <code>mockCouch.addDoc(database name, doc)</code></h3>
<p>Add a document to the specified database, and returns an object containing the <code>id</code> and the <code>_rev</code>.</p>
<p>The first argument is the name of the database (required). The second argument is an object containing the database (required).</p>
<p>If the document includes a <code>_id</code> or <code>_rev</code> properties, it will use them. Otherwise, it will create random ones for it.</p>
<pre><code class="language-javascript">var result = mockCouch.addDoc(&#39;people&#39;, { _id : &#39;third&#39;, value : 3 });
result.id === &#39;third&#39;; // true</code></pre>
<p><a name="properties"></a></p>
<h2>Instance Properties</h2>
<p>Each <strong>mock couch</strong> instance has the following properties:</p>
<p><a name="databases"></a></p>
<h3>databases <code>mockCouch.databases</code></h3>
<p>Each <strong>mock couch</strong> instance has a <code>databases</code> public property which is an object and, just like its name indicates, contains the databases of that instance.</p>
<h4>Properties</h4>
<p>Each database is an object, where each property is a document of the database.</p>
<p>The database object has the following properties with information about the database:</p>
<ul>
<li><code>__doc_count</code> : Return the number of documents in the database.</li>
</ul>
<p><a name="views"></a></p>
<h2>Views</h2>
<p>Mock Couch allows to create and use views.</p>
<p>To create a view, just create the <code>_design/*</code> document, with either <a href="#addDoc">addDoc</a> or <a href="#addDB">addDB</a>.</p>
<p>Make sure that the <code>map</code> and <code>reduce</code> functions are created as <em>as regular functions</em> - that is, <strong>not as strings</strong>.</p>
<p>This is an example:</p>
<pre><code class="language-javascript">mockCouch.addDoc(&#39;mydatabase&#39;, {
  _id: &#39;_design/myviews&#39;,
  views : {
    someview : {
      map : function(doc) {
        emit(null, { amount : doc._id });
      },
      reduce : function(keys, values, rereduce) {
        return values.reduce(function(a,b) {
          return a + b.amount;
        }, &#39;&#39;);
      }
    }
  }
});</code></pre>
<p>Then you can try the view from <code>http://localhost:5984/mydatabase/_design/myviews/_view/someview/</code></p>
<p><a name="events"></a></p>
<h2>Events</h2>
<p><strong>TBD</strong> (pretty soon!)</p>
<p><a name="license"></a></p>
<h2>License</h2>
<p><strong>MIT</strong></p>
</div></div></div><script src="js/main.min.js"></script></body></html>